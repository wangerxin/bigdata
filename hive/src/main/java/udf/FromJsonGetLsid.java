package udf;

import com.alibaba.fastjson.JSON;
import org.apache.hadoop.hive.ql.exec.UDF;


import java.util.List;
import java.util.Map;

public class FromJsonGetLsid extends UDF {

    /**
     * 步骤：1.json转map 2.从map拿到value，是一个list 3.遍历list的元素，拼接字符串
     *
     * @param json
     * @return
     */
    public static String evaluate(String json) {

        Map<String, List<Integer>> map = (Map<String, List<Integer>>) JSON.parse(json);
        String lsidStr = "";
        for (Map.Entry entry : map.entrySet()) {
            List<Integer> lsidList = (List<Integer>) entry.getValue();
            for (Integer lsid : lsidList) {
                lsidStr = lsidStr + lsid + ",";
            }
        }
        return lsidStr.substring(1, lsidStr.length() - 1);
    }

    public static void main(String[] args) {
        String json = "{\"2\":[30437049,30439100,30448654,30449043,30451241,30451318,30454460,30459206,30479436,30481945],\"4\":[30438132,30443980,30447927,30448784,30449239,30450168,30458354,30461113,30467477,30491093],\"33\":[30436393,30438672,30446794,30451032,30461805,30462685,30470309,30477072,30477950,30496202],\"35\":[30435961,30438924,30441409,30448601,30451080,30455680,30456287,30458777,30464525,30472214],\"41\":[30439645,30440710,30446509,30456695,30457763,30462547,30464752,30467969,30468069,30477325],\"47\":[30448934,30452103,30454401,30469270,30477042,30477242,30477579,30477747,30482156,30489989],\"88\":[30453801,30493698,30496452,30496584],\"95\":[30438402,30447606,30448828,30454508,30456090,30457529,30458748,30472228,30482856,30497303],\"115\":[30442791,30443411,30447198,30450307,30450973,30453976,30461036,30461413,30479039,30495231],\"158\":[30437240,30439518,30443955,30446995,30448059,30450642,30451168,30460752,30482934,30485628],\"159\":[30438072,30439688,30444097,30444749,30450987,30452865,30455899,30467054,30471917,30477948],\"260\":[30448045,30454206,30454436,30457819,30464896],\"261\":[30442824,30444070,30447248,30448403,30475845,30478098,30483766,30490490,30491798,30495578],\"285\":[30439069,30444402,30451242,30470345,30472093,30478025,30479552,30485580,30488844,30501275],\"400\":[30437796,30438819,30450934,30454478,30454738,30461379,30468724,30481073,30497609,30499086],\"401\":[30441079,30448380,30454393,30466318,30474573,30483579,30489992,30495975],\"403\":[30438591,30445257,30448187,30458655,30459213,30460344,30463359,30478375,30479759,30486369],\"519\":[30437921,30440094,30447147,30455543],\"543\":[30438239,30438684,30440162,30441463,30441652,30455685,30461088,30461828,30466539,30484506],\"626\":[30438088,30438164,30438648,30441205,30454755,30459573,30460528,30475064,30477135,30479858],\"631\":[30437195,30437310,30441866,30442810,30450968,30451079,30458854,30465923,30466566,30495320],\"653\":[30436897,30437930,30438185,30439474,30442771,30448611,30459567,30459647,30463065,30473793],\"656\":[30441067,30449831,30451099,30452487,30465201,30479013,30482263,30494251,30495014,30499485],\"659\":[30439722,30445650,30446788,30448485,30453609,30454733,30458750,30461200,30464714,30480386],\"668\":[30438145,30440453,30440742,30450635,30459759,30463485,30463761,30473134,30476052,30497767],\"670\":[30441059,30444102,30448000,30449189,30468304,30469318,30477804,30483724,30486789,30501754],\"683\":[30438106,30452997,30463042,30463923,30465025,30470219,30491027,30491256,30496871,30499937],\"710\":[30447310,30450269,30451206,30457871,30458970,30463593,30470388,30470823,30484773,30499434],\"715\":[30436614,30444931,30446309,30447204,30451086,30454954,30463678,30468839,30480851,30490373],\"778\":[30441189,30441639,30445098,30449313,30449589,30450392,30455630,30466932,30500088,30502570],\"826\":[30443190,30454974,30470525,30493217,30497365,30497877],\"840\":[30437412,30496137],\"846\":[30440830,30451351,30457483,30466575,30466854,30467166,30467745],\"921\":[30449773,30461530],\"1268\":[30442308,30442715,30443575,30443614,30443947,30445037,30449154,30451091,30452620,30462978],\"1329\":[30437343,30442784,30450295,30450344,30462809,30466055,30467072,30490987,30493628,30494985],\"1340\":[30439502,30448566,30449744,30451347,30454690,30460531,30460986,30462836,30482536,30494128],\"1351\":[30446178,30447083,30447263,30448377,30453764,30460715,30461982,30469266,30495915,30501492],\"1424\":[30440685,30449087,30456836,30458189,30459484,30461850,30468271,30478537,30486030],\"1496\":[30453083],\"1525\":[30440156,30441495,30445134,30457616,30463273,30467769,30468403,30469835,30470093,30480996],\"1533\":[30438116,30441182,30446989,30451307,30453863,30454028,30459387,30466794,30467371,30473416],\"1580\":[30438763,30440157,30440819,30449220,30452645,30459664,30460005,30472006,30497272,30498278],\"1586\":[30438203,30444161,30445432,30446131,30454169,30454422,30459400,30467476,30480812,30494177],\"1618\":[30437318,30442441,30446118,30447683,30454452,30493899,30494605],\"1623\":[30436825,30437831,30461830,30468878,30472813,30474590,30474704,30475847,30490466,30497635],\"1695\":[30437608,30441078,30443709,30447776,30453022,30459595,30465140,30467432,30467947,30476890],\"1706\":[30454467,30496795],\"1725\":[30437592,30444945,30446936,30453077,30453812,30458547,30460276,30467751,30491121,30496616],\"1733\":[30444979,30452874,30453119,30456604,30457739,30463598,30466368,30479124,30483367,30494558],\"1759\":[30439451,30441300,30443357,30452478,30453473,30476476],\"1811\":[30437238,30446333,30459901,30468066,30478492,30495315],\"1897\":[30446955,30448020,30450588,30455140,30462015,30473713,30476524,30480157,30494283,30498928],\"1899\":[30461790,30463362],\"1931\":[30437159,30447697,30451507,30460081,30467039,30482031,30487457,30496628,30499442],\"1965\":[30438688,30443282,30455040],\"2006\":[30436195,30440722,30443548,30448069,30475916,30494651],\"2064\":[30444538,30444772,30445742,30447353,30461338,30461935,30468031,30477935,30479022,30498962],\"2069\":[30441852,30457848],\"2071\":[30441452,30441904,30443628,30464514,30465207,30469040,30473421,30498068,30500349],\"2073\":[30437155,30439008,30443203,30446375,30448183,30452888,30455959,30459542,30462507,30484115],\"2101\":[30436008,30439613,30447876,30448496,30453553,30453698,30461855,30464489,30474741,30483282],\"2177\":[30437145,30447699,30451416,30463085,30477745,30501752],\"2231\":[30437249,30443079,30443677,30455855,30459197,30465347,30469855,30479877,30481241,30489897],\"2314\":[30436623,30439575,30447738,30448598,30448829,30450982,30454646,30470822,30485767,30489119],\"2318\":[30436291,30438194,30452378,30456185,30459528,30460878,30464036,30478974,30486844,30495862],\"2349\":[30444873,30454966,30459986],\"2397\":[30438816,30441069,30443334,30445233,30450600,30464495,30465044,30471405,30479281,30482148],\"2398\":[30435901,30436401,30444997,30445536,30454554,30461952,30466562,30466813,30469206,30482700],\"2405\":[30441180],\"2538\":[30451648,30466814,30472780,30497622],\"2558\":[30437785,30438823,30441185,30494457],\"2559\":[30438212,30439389,30459912,30462639,30463101,30466943,30468042,30470493,30481956,30487051],\"2596\":[30436325,30448466,30454736,30466037,30467868,30490667],\"2599\":[30436521,30440686,30457009,30457669,30460076,30467196,30477682,30481201,30481849,30502066],\"2683\":[30440197,30441226,30458575,30458743,30464926],\"2794\":[30436832,30437585,30438448,30440057,30442474,30443216,30443701,30451805,30453181,30462519],\"2962\":[30436330,30441294,30443227,30448800,30458166,30465809,30466363,30467916,30477779,30490038],\"3001\":[30441466],\"3088\":[30440466,30440720,30442884,30445752,30447823,30447865,30448630,30461994,30463025,30495717],\"3263\":[30438199,30439589,30441191,30451256,30451407,30468425,30475483,30477614,30479461,30493299],\"3264\":[30439532,30441130,30442169,30448880,30449860,30468825,30475879,30483325,30491017,30493484],\"3314\":[30464510,30499922],\"3338\":[30439692,30443154,30455810,30455889,30458798,30460114,30462821,30471727,30491339,30500734],\"3457\":[30459202,30502340],\"3460\":[30441481,30442463,30444522,30448087,30451681,30460399,30464541,30475588,30476255,30480760],\"3534\":[30437808,30439777,30441723,30446154,30451859,30453274,30456589,30463879,30467897,30469307],\"3564\":[30480373,30490978],\"3567\":[30459906,30467425],\"3620\":[30441310,30443728,30445799,30446947,30458686,30464801,30498732,30498925,30502308],\"3647\":[30499455],\"3651\":[30440501,30447700,30462860,30466365],\"3734\":[30443437,30454405,30454489,30460066,30460952,30467057,30473707,30491236],\"3735\":[30441426,30446132,30453047,30456028,30456226,30465776,30466691,30473721,30483634,30485345],\"3781\":[30441057,30448515,30453753,30454711,30455029,30462060,30464482,30467070,30471412,30473563],\"3809\":[30438080,30442284,30443276,30450266,30458729,30462026,30466708,30472373,30474508,30498043],\"3837\":[30443435,30445768,30455993,30473013],\"3842\":[30477290,30478752,30494963],\"3845\":[30441129,30467885,30479533,30498955],\"3852\":[30438861,30442191,30446951,30452917,30453321,30458504,30462350,30471716,30473044,30484758],\"3855\":[30443449,30447145,30452736,30457501,30457657,30464680,30471143,30474190,30476137,30493827],\"3971\":[30446046,30446975,30448086,30450370,30451151,30451799,30455732,30461033,30482301,30493621],\"4039\":[30439183,30441032,30460613,30482554],\"4089\":[30443185,30471667],\"4093\":[30440969,30450214,30467458,30477755],\"4096\":[30452142,30464793,30499102],\"4106\":[30443322,30453302,30456361,30460646,30462553,30464486,30476831,30478170,30480361,30494219],\"4139\":[30449066],\"4169\":[30438904,30443550,30447904,30449136,30450265,30451102,30476149,30495973,30497319,30497668],\"4178\":[30445051,30449371,30464264,30467529,30469410,30474759,30475341,30476236,30481440,30498007],\"4230\":[30448587,30451503,30454667,30468765,30469082,30483611,30487030,30487383,30487741,30502786],\"4253\":[30436316,30440663,30446941,30453012,30458518,30460246,30465318,30476801,30482608,30485612],\"4259\":[30440060,30443926,30454122,30468164,30472158,30475982,30478377,30478581,30488640,30499293],\"4260\":[30442364,30443030,30444911,30448080,30453453,30455709,30456994,30459394,30492775,30495537],\"4342\":[30438437,30474811],\"4400\":[30454308],\"4410\":[30437470,30462528,30478717,30485403,30496100],\"4448\":[30466683,30469630,30470877,30486968,30490678,30502606],\"4636\":[30442046,30451161,30451828,30462003,30471523,30475138,30480363,30480495,30496168,30499217],\"4935\":[30436815,30438092,30457704,30463125,30463338,30463711,30464826,30468780,30472052,30472976],\"4936\":[30442805,30448559,30449550,30454696,30457696,30460852,30464025,30478382,30485405,30498105],\"5137\":[30438517,30447280,30456314,30457221,30459113,30464532,30467874,30485190,30493337,30503462],\"5702\":[30439517,30444493,30448884,30450579,30459306,30464490,30472308,30473619,30476142,30480806],\"6369\":[30438165,30438381,30439515,30443489,30446818,30455235,30460195,30463130,30468867,30497232],\"6395\":[30441737,30459471,30464753,30465058,30474524,30493528],\"6433\":[30439064,30442080,30447781,30451233,30451783,30461711,30466731,30466805,30469453,30473775],\"6449\":[30437524,30441564,30458437,30458544,30460156,30465137,30467210,30467791,30481794,30493423],\"6513\":[30493541],\"6827\":[30442798,30451350,30454471,30461979,30465781,30475936,30475994,30476944,30494157,30502839],\"7159\":[30439671,30447153,30450452,30455827,30461919,30469723,30472555,30483283,30485205,30491227],\"7164\":[30439731,30443027,30444158,30451436,30458079,30462368,30473415,30473696,30480552],\"7176\":[30442146,30443477,30449223,30449701,30462497,30463745,30467069,30473570,30474197,30482779],\"7201\":[30437201,30441964,30443310,30451838,30455401,30455724,30459533,30461308,30461706,30495981],\"7214\":[30451022,30459482,30493240,30499035],\"7216\":[30436946,30454261,30470207,30470212,30475012,30478253,30484191,30488712,30490852,30497683],\"7282\":[30438029,30439634,30446924,30449659,30450243,30451061,30455716,30461949,30469388,30490399],\"7300\":[30443212,30455554,30464487],\"7322\":[30455096,30456304,30461989,30462653,30473149,30474570],\"7475\":[30442761,30446814,30451335,30452704,30461962,30463034,30474280,30477239,30491081,30493967],\"9482\":[30438113,30438783,30446520,30462960,30465975,30468050,30481932,30494511,30498036,30502958],\"9483\":[30440949,30444676,30454284,30463802,30465072,30475870,30481190,30481952,30483490,30490117],\"9508\":[30443472,30445674,30476509,30482619],\"9748\":[30441361,30449775,30458821,30460625,30461823,30463257,30471774,30480888,30481202,30482712],\"9989\":[30445720,30448590,30454660,30461885,30468046,30475907,30481157,30486867,30490536,30491532],\"10334\":[30447761,30454175,30457835,30458710,30468749,30470908,30474123,30477858,30491522,30497681],\"10581\":[30487523],\"10671\":[30437596,30438511,30439697,30454389,30455864,30457391,30461865,30472907,30473866,30476491],\"10744\":[30435972,30455115,30461472,30469950,30475818,30476988,30485502,30487305,30497524,30501258],\"10750\":[30440523,30444975,30470386,30475206,30477601,30480075,30480963,30493640,30499984],\"10753\":[30436665,30437946,30440085,30440088,30441208,30441228,30455139,30466909],\"10803\":[30438757,30468384,30468811,30474812,30482151],\"10807\":[30438075,30451249,30454553,30459756,30461035,30463660,30463809,30465010,30477702,30490505],\"10820\":[30436638,30461463,30463041,30464600,30466956,30467338],\"10876\":[30447531,30447534,30461031,30466498,30467215,30472347,30472946,30472990,30475501,30482653],\"10881\":[30441459,30456750],\"10883\":[30441631,30442563,30451105,30461610,30461868,30467078,30479035,30487094,30491478,30493331],\"10911\":[30437705,30446912,30447691,30457782,30467055,30471967,30472735,30477334,30480516,30491378],\"10925\":[30438104,30438201,30438395,30439905,30441429,30446922,30453085,30459961,30461812,30462867],\"10929\":[30443189,30446207,30447817,30450377,30450618,30452785,30456992,30470560,30470606,30480937],\"10932\":[30437842,30439562,30441665,30444844,30447540,30450654,30461396,30463551,30467975,30502996],\"10963\":[30438127,30438152,30439713,30457952,30463078,30469054,30480466,30486337,30487015,30502792],\"10964\":[30441474,30453611,30460072,30460756,30463810,30470062,30471301,30471505,30476570,30483767],\"10993\":[30436288,30457124,30470686,30471022,30474130,30476153,30499257],\"11016\":[30442325,30455537,30461883,30473009],\"11080\":[30445415,30447027,30455371,30455653,30457810,30462605,30462891,30464024,30466958,30470838],\"11083\":[30482645],\"16586\":[30440342,30444416,30446300,30448554,30454230,30454707,30457840,30458177,30470701,30475786],\"20821\":[30444519,30450609,30452056,30453814,30457494,30459488],\"21305\":[30447160,30453495,30462596,30475002,30493289,30497392,30502872,30503324],\"24955\":[30449624,30451653,30456776,30463459,30466263,30475403,30481037,30485486,30488235,30502621],\"25408\":[30442985,30454441,30458548,30487534],\"26119\":[30439624,30446964,30448510,30448725,30454716,30455513,30458312,30468874,30485385,30495068],\"27145\":[30447008,30460092,30462351,30464882,30476998],\"27155\":[30436629,30440287,30440296,30448835,30452722,30453680],\"27857\":[30436063,30439527,30444140,30446775,30465211,30467510,30467986,30481295,30487729,30496449],\"34273\":[30475515],\"35235\":[30448989,30489933,30493242],\"35236\":[30435986,30438215,30438664,30441014,30443247,30443389,30443719,30448230,30453544,30455701],\"36425\":[30471103],\"49486\":[30438078,30439679,30461430,30462687,30464521,30468026,30469710,30473080,30483501,30485230],\"51659\":[30437157,30441340,30448066,30448577,30450294,30451075,30456968,30468915,30470003,30496967],\"80098\":[30438101,30446827,30452790,30461069,30464466,30469574,30472150,30476980,30485377,30502197],\"80100\":[30445501,30459801,30460245,30499737],\"80230\":[30450049,30454131,30457731,30483385,30487536,30487914],\"80367\":[30451400,30466389],\"80443\":[30439965,30443332,30444069,30459764,30462648,30463082,30464851,30470468,30477690,30480630],\"80445\":[30437752,30444077,30445095,30447680,30456411,30465475,30486237,30489855,30498502]}";
        System.out.println(evaluate(json));

    }

}
